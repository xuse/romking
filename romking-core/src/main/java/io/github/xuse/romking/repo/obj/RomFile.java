package io.github.xuse.romking.repo.obj;

import java.sql.Types;
import java.time.Instant;
import java.util.Date;
import java.util.Map;

import com.github.xuse.querydsl.annotation.AutoGenerated;
import com.github.xuse.querydsl.annotation.CustomType;
import com.github.xuse.querydsl.annotation.GeneratedType;
import com.github.xuse.querydsl.annotation.UnsavedValue;
import com.github.xuse.querydsl.annotation.dbdef.ColumnSpec;
import com.github.xuse.querydsl.annotation.dbdef.Key;
import com.github.xuse.querydsl.annotation.dbdef.TableSpec;
import com.github.xuse.querydsl.datatype.JSONObjectType;
import com.github.xuse.querydsl.types.EnumByCodeType;

import io.github.xuse.romking.core.GameType;
import io.github.xuse.romking.core.Platform;
import io.github.xuse.romking.repo.enums.Region;
import io.github.xuse.romking.repo.enums.WrapType;
import io.github.xuse.romking.util.RandomValue;
import io.github.xuse.romking.util.ValueType;
import lombok.Data;

@Data
@TableSpec(name = "rom_file",primaryKeys = {"id"},
keys = {
		@Key(path= {"name"}),
		@Key(path= {"dirId","romName"}),
		@Key(path= {"md5","length"},name = "idx_global_rom_md5"),
		@Key(path= {"crc","length"},name = "idx_global_rom_crc"),
		@Key(path= {"gameid"}),
})
public class RomFile {

	/**
	 * 所属仓库
	 */
	@ColumnSpec(nullable = false,type=Types.INTEGER,unsigned = true)
	@UnsavedValue(UnsavedValue.ZeroAndMinus)
	private int dirId; 
	
	/**
	 * 主键
	 */
	@ColumnSpec(nullable = false,type=Types.INTEGER,unsigned = true,autoIncrement = true)
	@RandomValue(ignore = true)
	private int id;
	
	/**
	 * 相对仓库根目录路径，如果ROM在ZIP中，此处是ZIP文件名。
	 * 如果是目录作为单个游戏ROM，那么这里是目录名
	 */
	@ColumnSpec(name="file_path",nullable = false,size = 256,type = Types.VARCHAR)
	private String filepath;
	
	/**
	 * 文件包装形式
	 */
	@ColumnSpec(name="wrapType",nullable = false,type = Types.TINYINT,unsigned = true)
	@CustomType(EnumByCodeType.class)
	private WrapType wrapType;
	
	/**
	 * 在平台标准编号系统中的ID
	 */
	@ColumnSpec(name="gameid",nullable = false,size = 64,type = Types.VARCHAR,defaultValue = "''")
	private String gameid;

	/**
	 * 游戏名
	 */
	@ColumnSpec(name="name",nullable = false,size = 64,type = Types.VARCHAR,defaultValue = "''")
	private String name;
	
	/**
	 * 游戏类型
	 */
	@ColumnSpec(name="type",nullable = true,size = 8,type = Types.VARCHAR)
	private GameType gameType;
	
	/**
	 * 发行版本
	 */
	@ColumnSpec(nullable = false,type = Types.TINYINT,unsigned = true)
	@CustomType(EnumByCodeType.class)
	private Region region;
	
	/**
	 * 如果是ZIP文件，内部文件数。非ZIP文件为0
	 */
	@ColumnSpec(name="zipped_files",nullable = false,type=Types.INTEGER,unsigned = true)
	@UnsavedValue(UnsavedValue.MinusNumber)
	private int zippedFiles;
	
	/**
	 * 版本、携带DLC等信息
	 */
	@ColumnSpec(nullable = true,type=Types.VARCHAR,size = 256)
	private String version;
	
	/**
	 * 自行修改版的ROM信息。
	 */
	@ColumnSpec(name="hack",nullable = true,type=Types.VARCHAR,size = 256)
	private String hackComment;
	
	/**
	 * 所属平台
	 */
	@ColumnSpec(nullable = false,type = Types.VARCHAR, size=14)
	private Platform platform;
	
	/**
	 * 游戏文件名，对于压缩在ZIP中的文件，是指ZIP内的文件名
	 */
	@ColumnSpec(name="rom_name",nullable = false,type=Types.VARCHAR,size = 256)
	private String romName;
	
	/**
	 * 游戏ROM扩展名。
	 */
	@ColumnSpec(name="rom_ext",nullable = false,type=Types.VARCHAR,size = 10)
	@RandomValue(value = ValueType.ENGLISH_LOWER,length = 3)
	private String romExt;

	/**
	 * ROM文件修改时间
	 */
	@ColumnSpec(name="rom_modify",nullable = false,type=Types.TIMESTAMP)
	private Date romModified;
	
	/**
	 * ROM文件长度。如果是多文件的ROM，则将包视为ROM文件。取其长度
	 */
	@ColumnSpec(name="rom_len",nullable = false,type=Types.BIGINT,defaultValue = "0")
	@UnsavedValue(UnsavedValue.MinusNumber)
	private long length;
	
	/**
	 * CRC
	 */
	@ColumnSpec(name="crc",nullable = true,type=Types.CHAR,size=8)
	@RandomValue(length = 8, value=ValueType.ENGLISH_LOWER)
	private String crc;
	
	/**
	 * MD5
	 */
	@ColumnSpec(name="md5",nullable = true,type=Types.CHAR,size=32)
	@RandomValue(length = 32, value=ValueType.ENGLISH_LOWER)
	private String md5;
	
	/**
	 * 其他媒体信息
	 */
	@ColumnSpec(nullable =true,type=Types.VARCHAR,size=1400)
	@CustomType(JSONObjectType.class)
	private Map<String,Object> medias;
	
	/**
	 * 偏好
	 */
	@ColumnSpec(name="fav",type=Types.TINYINT,unsigned = true,nullable = false, defaultValue = "0")
	@UnsavedValue(UnsavedValue.MinusNumber)
	@RandomValue(numberMax = 10)
	private int favorite;
	
	@ColumnSpec(nullable = false)
	@AutoGenerated(GeneratedType.CREATED_TIMESTAMP)
    private Instant createTime;

}
